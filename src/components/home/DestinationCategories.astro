---
import { Icon } from 'astro-icon/components';
import { getCollection } from 'astro:content';
import { getDestinationsByTag } from '../../utils/content.js';

// Definir las categor√≠as basadas en experiencias con sus correspondientes tags
const experienceCategories = [
  {
    title: "Aventura",
    description: "Experiencias emocionantes para los amantes de la adrenalina",
    icon: "üèîÔ∏è",
    tag: "Aventura",
    bgColor: "bg-green-100",
    textColor: "text-green-600",
    url: "/destinos/tag/aventura"
  },
  {
    title: "Playa",
    description: "Relax y descanso junto al mar",
    icon: "üèñÔ∏è",
    tag: "Playa",
    bgColor: "bg-cyan-100",
    textColor: "text-cyan-600",
    url: "/destinos/tag/playa"
  },
  {
    title: "Rom√°ntico",
    description: "Escapadas perfectas para parejas",
    icon: "‚ù§Ô∏è",
    tag: "Rom√°ntico",
    bgColor: "bg-pink-100",
    textColor: "text-pink-600",
    url: "/destinos/tag/rom√°ntico"
  },
  {
    title: "Cultural",
    description: "Historia, patrimonio y experiencias aut√©nticas",
    icon: "üèõÔ∏è",
    tag: "Cultural",
    bgColor: "bg-purple-100",
    textColor: "text-purple-600",
    url: "/destinos/tag/cultural"
  },
  {
    title: "Ecoturismo",
    description: "Viajes responsables y sostenibles en la naturaleza",
    icon: "üåø",
    tag: "Ecoturismo",
    bgColor: "bg-emerald-100",
    textColor: "text-emerald-600",
    url: "/destinos/tag/ecoturismo"
  },
  {
    title: "Familiar",
    description: "Destinos ideales para viajar con ni√±os",
    icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
    tag: "Familiar",
    bgColor: "bg-blue-100",
    textColor: "text-blue-600",
    url: "/destinos/tag/familiar"
  },
  {
    title: "Todo Incluido",
    description: "Paquetes completos sin preocupaciones",
    icon: "üè®",
    tag: "Todo incluido",
    bgColor: "bg-yellow-100",
    textColor: "text-yellow-600",
    url: "/destinos/tag/todo-incluido"
  },
  {
    title: "Cruceros",
    description: "Experiencias a bordo por los mejores destinos",
    icon: "üö¢",
    tag: "Crucero",
    bgColor: "bg-indigo-100",
    textColor: "text-indigo-600",
    url: "/destinos/cruceros"
  }
];

// Obtener las principales categor√≠as de destinos (nacional/internacional)
const mainCategories = [
  {
    title: "Destinos Nacionales",
    description: "Descubre la belleza de Colombia",
    image: "/images/uploads/colombia-banner.jpg",
    url: "/destinos/nacionales",
    tag: "nacional",
    cta: "Ver todos"
  },
  {
    title: "Destinos Internacionales",
    description: "Explora el mundo con nosotros",
    image: "/images/uploads/internacional-banner.jpg",
    url: "/destinos/internacionales",
    tag: "internacional",
    cta: "Ver todos"
  },
  {
    title: "Ofertas Especiales",
    description: "Promociones exclusivas",
    image: "/images/uploads/ofertas-banner.jpg",
    url: "/promociones",
    tag: "Oferta",
    cta: "Ver ofertas"
  }
];

// Contar cu√°ntos destinos hay por cada categor√≠a
const destinationCounts = new Map();

// Obtener todos los destinos y contar por categor√≠a
try {
  const allDestinations = await getCollection('destinations');
  
  // Inicializar contador para cada tag
  experienceCategories.forEach(category => {
    destinationCounts.set(category.tag, 0);
  });
  
  // Contar destinos por tag
  allDestinations.forEach(destination => {
    // Verificar tag principal
    if (destination.data.tag) {
      const count = destinationCounts.get(destination.data.tag) || 0;
      destinationCounts.set(destination.data.tag, count + 1);
    }
    
    // Verificar tags adicionales
    if (Array.isArray(destination.data.tags)) {
      destination.data.tags.forEach(tag => {
        const count = destinationCounts.get(tag) || 0;
        destinationCounts.set(tag, count + 1);
      });
    }
  });
} catch (error) {
  console.error('Error al calcular conteo de destinos por categor√≠a:', error);
}
---

<section class="py-20 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold text-gray-900 mb-4">Explora nuestras categor√≠as de destinos</h2>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto">
        Encuentra el viaje perfecto entre nuestra selecci√≥n de destinos para todos los gustos y presupuestos
      </p>
    </div>
    
    <!-- Categor√≠as principales: Nacional/Internacional/Ofertas -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
      {mainCategories.map((category) => (
        <div class="group relative overflow-hidden rounded-xl shadow-lg transition-all duration-300 hover:shadow-xl">
          <div class="relative h-64 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-black/20 z-10"></div>
            <img 
              src={category.image} 
              alt={category.title} 
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              onerror="this.src='/images/placeholder.jpg'; this.onerror=null;"
            />
            <div class="absolute inset-0 flex flex-col justify-end p-6 text-white z-20">
              <h3 class="text-3xl font-bold mb-2">{category.title}</h3>
              <p class="text-lg text-gray-100 mb-4">{category.description}</p>
              <a 
                href={category.url}
                class="inline-flex items-center bg-white text-blue-600 px-4 py-2 rounded-md font-medium hover:bg-blue-50 transition-colors"
              >
                {category.cta}
                <Icon name="tabler:arrow-right" class="w-4 h-4 ml-2" />
              </a>
            </div>
          </div>
        </div>
      ))}
    </div>
    
    <!-- Categor√≠as de experiencia -->
    <h3 class="text-2xl font-bold text-center text-gray-900 mb-8">Viaja seg√∫n tu estilo</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      {experienceCategories.map((category) => (
        <a 
          href={category.url} 
          class="bg-white rounded-lg shadow-md p-6 flex items-center hover:shadow-lg transition-shadow transform hover:-translate-y-1 duration-300"
        >
          <div class={`${category.bgColor} p-3 rounded-full mr-4`}>
            <span class={`${category.textColor} text-2xl`}>{category.icon}</span>
          </div>
          <div>
            <div class="flex items-center gap-2">
              <h3 class="font-bold text-gray-900">{category.title}</h3>
              {destinationCounts.get(category.tag) > 0 && (
                <span class="text-xs bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full">
                  {destinationCounts.get(category.tag)} destinos
                </span>
              )}
            </div>
            <p class="text-sm text-gray-600">{category.description}</p>
          </div>
        </a>
      ))}
    </div>
    
    <div class="text-center mt-12">
      <a 
        href="/destinos"
        class="inline-block bg-blue-600 text-white py-3 px-8 rounded-md text-lg font-medium hover:bg-blue-700 transition-colors"
      >
        Ver todos nuestros destinos
      </a>
    </div>
  </div>
</section>